<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Julie's Bakeshop - Login</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="login.css">
</head>
<body>
    <div class="login-container">
        <header class="login-header">
            <div class="logo-container">
                <div class="logo">
                    <span class="logo-icon">ü•ê</span>
                    <div class="logo-text">
                        <span class="logo-julies">JULIE'S</span>
                        <span class="logo-bakeshop">BAKESHOP</span>
                    </div>
                </div>
            </div>
            <div class="datetime-container">
                <div class="time" id="current-time">12:00:00 PM</div>
                <div class="date" id="current-date">Loading...</div>
            </div>
        </header>

        <div class="sparkle sparkle-1">‚ú¶</div>
        <div class="sparkle sparkle-2">‚ú¶</div>
        <div class="sparkle sparkle-3">‚ú¶</div>
        <div class="sparkle sparkle-4">‚ú¶</div>

        <main class="login-main">
            <div class="logo-image-container">
                <img src="julies-logo.png" alt="Julie's Bakeshop" class="logo-image">
            </div>

            <h1 class="welcome-title">Welcome to Julie's Bakeshop</h1>

            <form class="login-form" id="loginForm">
                <div class="login-error" id="errorMsg"></div>

                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="emailInput" placeholder="Enter your email" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="passwordInput" placeholder="Enter your password" required>
                </div>

                <button type="submit" class="login-btn" id="loginBtn">Login</button>
            </form>
        </main>

        <div class="footer-wave"></div>
    </div>

    <script src="auth.js?v=3"></script>
    <script>
        // Clock
        function updateClock() {
            var now = new Date();
            var h = now.getHours();
            var m = now.getMinutes().toString().padStart(2, '0');
            var s = now.getSeconds().toString().padStart(2, '0');
            var ampm = h >= 12 ? 'PM' : 'AM';
            h = h % 12 || 12;

            document.getElementById('current-time').textContent = h + ':' + m + ':' + s + ' ' + ampm;
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });
        }
        setInterval(updateClock, 1000);
        updateClock();

        // CLEAR ANY OLD SESSION ON LOGIN PAGE LOAD
        JuliesAuth.clearSession();

        // Focus email
        document.getElementById('emailInput').focus();

        // Handle form submit
        document.getElementById('loginForm').onsubmit = function(e) {
            e.preventDefault();

            var email = document.getElementById('emailInput').value;
            var password = document.getElementById('passwordInput').value;
            var errorMsg = document.getElementById('errorMsg');
            var loginBtn = document.getElementById('loginBtn');

            // Hide error
            errorMsg.style.display = 'none';

            // Disable button
            loginBtn.disabled = true;
            loginBtn.textContent = 'Logging in...';

            // Try login
            setTimeout(function() {
                var user = JuliesAuth.login(email, password);

                if (user) {
                    // SUCCESS - redirect based on role
                    window.location.href = JuliesAuth.getRedirectUrl(user);
                } else {
                    // FAILED
                    errorMsg.textContent = 'Invalid email or password';
                    errorMsg.style.display = 'block';
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'Login';
                }
            }, 300);
        };
    </script>
</body>
</html>
