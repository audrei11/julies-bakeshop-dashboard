<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Julie's Bakeshop - Financial Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Data Refresh Indicator -->
    <div class="data-refresh-indicator" id="refresh-indicator">
        <span class="loading-spinner"></span>
        <span>Syncing data...</span>
    </div>

    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="logo-container">
                <div class="logo">
                    <span class="logo-icon">ü•ê</span>
                    <div class="logo-text">
                        <span class="logo-julies">JULIE'S</span>
                        <span class="logo-bakeshop">BAKESHOP</span>
                    </div>
                </div>
                <span class="sparkle">‚ú¶</span>
            </div>
            <div class="header-buttons">
                <button class="logout-btn" id="logout-btn" title="Back to Login">
                    <svg class="logout-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
                    </svg>
                    <span>Logout</span>
                </button>
                <button class="refresh-btn" id="refresh-btn" title="Refresh Data">
                    <svg class="refresh-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                    </svg>
                    <span>Refresh</span>
                </button>
            </div>
            <div class="datetime-container">
                <div class="time" id="current-time">10:55:29 AM</div>
                <div class="date" id="current-date">Sunday, January 18, 2026</div>
            </div>
        </header>

        <!-- Cluster Navigation -->
        <nav class="cluster-nav-bar">
            <div class="cluster-nav-label">
                <span class="nav-label-icon">üìç</span>
                <span class="nav-label-text">Clusters</span>
            </div>
            <div class="cluster-nav-buttons">
                <a href="cluster.html?cluster=blumentrit" class="cluster-nav-btn" data-cluster="blumentrit">
                    <span class="cluster-nav-icon">üè™</span>
                    <span class="cluster-nav-name">Blumentrit</span>
                </a>
                <a href="cluster.html?cluster=balicbalic" class="cluster-nav-btn" data-cluster="balicbalic">
                    <span class="cluster-nav-icon">üè™</span>
                    <span class="cluster-nav-name">Balicbalic</span>
                </a>
                <a href="cluster.html?cluster=kalentong" class="cluster-nav-btn" data-cluster="kalentong">
                    <span class="cluster-nav-icon">üè™</span>
                    <span class="cluster-nav-name">Kalentong</span>
                </a>
                <a href="cluster.html?cluster=paco" class="cluster-nav-btn" data-cluster="paco">
                    <span class="cluster-nav-icon">üè™</span>
                    <span class="cluster-nav-name">Paco</span>
                </a>
            </div>
        </nav>

        <!-- Greeting -->
        <div class="greeting">
            <h1><span class="greeting-name">Hello, Jeanvie!</span> Here are your financial details.</h1>
        </div>

        <!-- Stats Cards -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-label">Total Balance</div>
                <div class="stat-value" id="total-balance">‚Ç±0</div>
                <div class="stat-change positive" id="balance-change">
                    <span class="change-icon">‚ú¶</span>
                    <span>Loading...</span>
                </div>
                <div class="card-diamond top-left"></div>
                <div class="card-diamond bottom-right"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">This Week</div>
                <div class="stat-value" id="this-week">‚Ç±0</div>
                <div class="stat-change positive" id="week-change">
                    <span class="change-icon">‚ú¶</span>
                    <span>Loading...</span>
                </div>
                <div class="card-diamond top-left"></div>
                <div class="card-diamond bottom-right"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">This Month</div>
                <div class="stat-value" id="this-month">‚Ç±0</div>
                <div class="stat-change positive" id="month-change">
                    <span class="change-icon">‚ú¶</span>
                    <span>Loading...</span>
                </div>
                <div class="card-diamond top-left"></div>
                <div class="card-diamond bottom-right"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">This Year</div>
                <div class="stat-value large" id="this-year">‚Ç±0</div>
                <div class="stat-change positive" id="year-change">
                    <span class="change-icon">‚ú¶</span>
                    <span>Loading...</span>
                </div>
                <div class="card-diamond top-left"></div>
                <div class="card-diamond bottom-right"></div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Recent Transactions -->
            <div class="transactions-section">
                <h2 class="section-title">Recent Transactions</h2>
                <div class="filter-tabs">
                    <button class="filter-tab active">All</button>
                    <button class="filter-tab">Food & Dining</button>
                    <button class="filter-tab">Shopping</button>
                    <button class="view-all-btn" id="view-all-btn">View All</button>
                </div>
                <div class="transactions-table">
                    <div class="table-header">
                        <span>Date</span>
                        <span>Cluster</span>
                        <span>Expense Description</span>
                        <span>Account Name</span>
                        <span>Submitted</span>
                        <span>Amount</span>
                    </div>
                    <div id="transactions-container">
                        <!-- Transactions will be loaded dynamically from Google Sheets -->
                        <div class="loading-message">Loading transactions...</div>
                    </div>
                </div>
                <div class="button-group">
                    <button class="set-budget-btn">
                        <span class="budget-icon">üìÅ</span>
                        Set Budget
                    </button>
                    <button class="add-pcf-btn" id="add-pcf-btn">
                        <span class="pcf-icon">‚ûï</span>
                        Add PCF
                    </button>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="right-panel">
                <!-- Main Cost Center Breakdown Chart -->
                <div class="breakdown-section">
                    <h2 class="section-title">Cost Center Breakdown</h2>
                    <div class="breakdown-content-3d">
                        <div class="pie-chart-3d-wrapper">
                            <div class="pie-chart-labels" id="pie-chart-labels">
                                <!-- Labels will be added by JavaScript -->
                            </div>
                            <div class="pie-chart-3d-container">
                                <canvas id="donutChart" width="280" height="280"></canvas>
                            </div>
                        </div>
                        <div class="breakdown-legend-3d" id="breakdown-legend">
                            <!-- Legend will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- 5 Cost Center Mini Charts -->
                <div class="cost-center-charts-section">
                    <h2 class="section-title">Cost Center Expense Breakdown</h2>
                    <div class="cost-center-charts-grid">
                        <!-- Blumentrit Chart -->
                        <div class="cost-center-chart-card" data-center="blumentrit">
                            <h3 class="chart-title">BLUMENTRIT</h3>
                            <div class="chart-wrapper">
                                <div class="chart-labels" id="labels-blumentrit"></div>
                                <div class="mini-chart-container">
                                    <canvas id="chart-blumentrit" width="140" height="140"></canvas>
                                    <div class="chart-center-value" id="center-blumentrit">‚Ç±0</div>
                                </div>
                            </div>
                            <div class="chart-total" id="total-blumentrit">‚Ç±0</div>
                            <div class="chart-legend" id="legend-blumentrit"></div>
                        </div>
                        <!-- Deca Chart -->
                        <div class="cost-center-chart-card" data-center="deca">
                            <h3 class="chart-title">DECA</h3>
                            <div class="chart-wrapper">
                                <div class="chart-labels" id="labels-deca"></div>
                                <div class="mini-chart-container">
                                    <canvas id="chart-deca" width="140" height="140"></canvas>
                                    <div class="chart-center-value" id="center-deca">‚Ç±0</div>
                                </div>
                            </div>
                            <div class="chart-total" id="total-deca">‚Ç±0</div>
                            <div class="chart-legend" id="legend-deca"></div>
                        </div>
                        <!-- Walter Chart -->
                        <div class="cost-center-chart-card" data-center="walter">
                            <h3 class="chart-title">WALTER</h3>
                            <div class="chart-wrapper">
                                <div class="chart-labels" id="labels-walter"></div>
                                <div class="mini-chart-container">
                                    <canvas id="chart-walter" width="140" height="140"></canvas>
                                    <div class="chart-center-value" id="center-walter">‚Ç±0</div>
                                </div>
                            </div>
                            <div class="chart-total" id="total-walter">‚Ç±0</div>
                            <div class="chart-legend" id="legend-walter"></div>
                        </div>
                        <!-- Gagalangin Chart -->
                        <div class="cost-center-chart-card" data-center="gagalangin">
                            <h3 class="chart-title">GAGALANGIN</h3>
                            <div class="chart-wrapper">
                                <div class="chart-labels" id="labels-gagalangin"></div>
                                <div class="mini-chart-container">
                                    <canvas id="chart-gagalangin" width="140" height="140"></canvas>
                                    <div class="chart-center-value" id="center-gagalangin">‚Ç±0</div>
                                </div>
                            </div>
                            <div class="chart-total" id="total-gagalangin">‚Ç±0</div>
                            <div class="chart-legend" id="legend-gagalangin"></div>
                        </div>
                        <!-- Fajardo Chart -->
                        <div class="cost-center-chart-card" data-center="fajardo">
                            <h3 class="chart-title">FAJARDO</h3>
                            <div class="chart-wrapper">
                                <div class="chart-labels" id="labels-fajardo"></div>
                                <div class="mini-chart-container">
                                    <canvas id="chart-fajardo" width="140" height="140"></canvas>
                                    <div class="chart-center-value" id="center-fajardo">‚Ç±0</div>
                                </div>
                            </div>
                            <div class="chart-total" id="total-fajardo">‚Ç±0</div>
                            <div class="chart-legend" id="legend-fajardo"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PCF Modal -->
    <div class="modal-overlay" id="pcf-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">PCF</h2>
                <p class="modal-subtitle">PCF DAILY BLUMENTRITT</p>
                <button class="modal-close" id="pcf-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="pcf-form">
                    <div class="form-group">
                        <label class="form-label">date</label>
                        <input type="date" class="form-input" id="pcf-date" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Cluster</label>
                        <input type="text" class="form-input" id="pcf-cluster" placeholder="">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Expense Description</label>
                        <input type="text" class="form-input" id="pcf-expense-desc" placeholder="">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Cost center</label>
                        <select class="form-select" id="pcf-cost-center">
                            <option value="">Select an option ...</option>
                            <option value="jbs-22348-blumentrit">Jbs 22348 blumentrit</option>
                            <option value="jbs-23582-deca">Jbs 23582 deca</option>
                            <option value="jbs-24723-walter">Jbs 24723 walter</option>
                            <option value="jbs-23974-gagalangin">Jbs 23974 gagalangin</option>
                            <option value="jbs-22755-fajardo">Jbs 22755 Fajardo</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Vendor</label>
                        <input type="text" class="form-input" id="pcf-vendor" placeholder="">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Tin#</label>
                        <input type="text" class="form-input" id="pcf-tin" placeholder="">
                    </div>

                    <div class="form-group">
                        <label class="form-label">OR/ si#</label>
                        <input type="text" class="form-input" id="pcf-or-si" placeholder="">
                    </div>

                    <div class="form-group">
                        <label class="form-label">AMOUNT WITH VAT</label>
                        <input type="number" step="0.01" class="form-input" id="pcf-amount-vat" placeholder="">
                    </div>

                    <div class="form-group">
                        <label class="form-label">EXvat</label>
                        <input type="number" step="0.01" class="form-input" id="pcf-exvat" placeholder="">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Account name</label>
                        <select class="form-select" id="pcf-account-name">
                            <option value="">Select an option ...</option>
                            <option value="bakery-supplies-consumable">Bakery Supplies - Consumable Items / 6511000101</option>
                            <option value="bakery-supplies-durable">Bakery Supplies - Durable Items / 6511000102</option>
                            <option value="business-licenses">Business and Other Licenses / 7711000102</option>
                            <option value="cleaning-supplies">Cleaning Supplies / 6221000104</option>
                            <option value="cos-perishable">COS - Perishable Ingredients / 5111000102</option>
                            <option value="donations">Donations & Contributions / 7811000101</option>
                            <option value="equipment-maint">Equipment Maint and Repair / 6911000101</option>
                            <option value="facility-maint">Facility Maint and Repair / 6211000102</option>
                            <option value="insurance">Insurance Expenses / 7711000101</option>
                            <option value="legal-fees">Legal Fees / 6311000105</option>
                            <option value="local-transport">Local Transportation / 6311000105</option>
                            <option value="furniture-maint">Maint and Repair - Furniture and Fixtures / 7211000102</option>
                            <option value="medical-direct">Medical & Hospitalization Direct Labor / 5122000106</option>
                            <option value="medical-indirect">Medical & Hospitalization Indirect Labor / 6121000106</option>
                            <option value="meeting-expenses">Meeting Expenses / 7141000101</option>
                            <option value="mobile-data">Mobile Data Connectivity / 7121000104</option>
                            <option value="photocopying">Photocopying / 7111000102</option>
                            <option value="printing">Printing / 7111000101</option>
                            <option value="stationary">Stationary and Supplies / 7112000101</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">VAT</label>
                        <input type="number" step="0.01" class="form-input" id="pcf-vat" placeholder="">
                    </div>

                    <button type="submit" class="form-submit-btn">Submit</button>
                </form>
            </div>
        </div>
    </div>

    <!-- View All Transactions Modal -->
    <div class="modal-overlay" id="transactions-modal">
        <div class="modal-content transactions-modal-content">
            <div class="modal-header">
                <h2 class="modal-title">All Transactions</h2>
                <p class="modal-subtitle">Complete transaction history from Google Sheets</p>
                <button class="modal-close" id="transactions-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Search and Filter Bar -->
                <div class="transactions-search-bar">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="M21 21l-4.35-4.35"></path>
                        </svg>
                        <input type="text" class="search-input" id="transaction-search" placeholder="Search transactions...">
                    </div>
                    <div class="filter-dropdown-wrapper">
                        <select class="filter-dropdown" id="cost-center-filter">
                            <option value="all">All Cost Centers</option>
                            <option value="blumentrit">Blumentrit (22348)</option>
                            <option value="deca">Deca (23582)</option>
                            <option value="walter">Walter (24723)</option>
                            <option value="gagalangin">Gagalangin (23974)</option>
                            <option value="fajardo">Fajardo (22755)</option>
                        </select>
                    </div>
                </div>
                <div class="transactions-modal-table">
                    <div class="transactions-modal-header">
                        <span>Date</span>
                        <span>Cluster</span>
                        <span>Expense Description</span>
                        <span>Account Name</span>
                        <span>Vendor</span>
                        <span>Amount</span>
                    </div>
                    <div class="transactions-modal-body" id="all-transactions-container">
                        <div class="loading-message">Loading all transactions...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chatbot -->
    <div class="chatbot-container" id="chatbot">
        <div class="chatbot-toggle" id="chatbot-toggle">
            <img src="julies-logo.png" alt="Julie's Assistant" class="chatbot-avatar">
            <span class="chatbot-badge">1</span>
        </div>
        <div class="chatbot-window" id="chatbot-window">
            <div class="chatbot-header">
                <img src="julies-logo.png" alt="Julie's" class="chatbot-header-avatar">
                <div class="chatbot-header-info">
                    <span class="chatbot-name">Julie's Assistant</span>
                    <span class="chatbot-status">Online</span>
                </div>
                <button class="chatbot-close" id="chatbot-close">&times;</button>
            </div>
            <div class="chatbot-messages" id="chatbot-messages">
                <div class="chat-message bot">
                    <img src="julies-logo.png" alt="Julie's" class="message-avatar">
                    <div class="message-content">
                        <p>Hi Jeanvie! üëã Welcome to Julie's Bakeshop! How can I help you today?</p>
                        <span class="message-time">Just now</span>
                    </div>
                </div>
            </div>
            <div class="chatbot-suggestions">
                <button class="suggestion-btn" data-message="Check my balance">üí∞ Check Balance</button>
                <button class="suggestion-btn" data-message="Show recent transactions">üìã Transactions</button>
                <button class="suggestion-btn" data-message="Help with budget">üìä Budget Help</button>
            </div>
            <div class="chatbot-input-container">
                <input type="text" class="chatbot-input" id="chatbot-input" placeholder="Type your message...">
                <button class="chatbot-send" id="chatbot-send">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script src="auth.js?v=4"></script>
    <script>
        // Protect dashboard - only admin can access
        if (JuliesAuth.protectDashboard()) {
            JuliesAuth.updateGreeting();
        }
        // If false, redirect already happened
    </script>
    <script src="script.js"></script>
</body>
</html>
